---
title: "MSADS506 M4 UE Wang"
output: html_document
---
# Chapter 8: Forecasting Binary Outcomes (Pages 187-188): #4-7

```{r}
# load the packages

library(readxl)
library(tidyverse)
library(fpp2)
library(zoo)
library(readr)
library(dplyr)
library(ggplot2)
library(forecast)
library(caret)
set.seed(506)
```

```{r}
PowderyMildewEpidemic <- read_csv("/Users/UE/Desktop/PowderyMildewEpidemic.csv", show_col_types = FALSE)
PowderyMildewEpidemic$Outbreak <- ifelse(PowderyMildewEpidemic$Outbreak == 'Yes', 1, 0)
PowderyMildewEpidemic
```

Q4. Compute naive forecasts of epidemic status for years 1995-1997 using next-year forecasts (Ft|1 = Ft ). What is the naive forecast for the year 2000? Summarize the results for these four years in a classification matrix.

```{r}
naive_forecast <- PowderyMildewEpidemic %>%
  mutate(lag = lag(Outbreak , 1)) %>%
  filter(Year >= 1995)
confusionMatrix(as.factor(naive_forecast$Outbreak), as.factor(naive_forecast$lag))
```

Q5. Partition the data into training and validation periods, so that years 1987-1994 are the training period. Fit a logistic regression to the training period using the two predictors and report the outbreak probability as well as a forecast for year 1995 (use a threshold of 0.5).

```{r}
train <- PowderyMildewEpidemic %>%
  filter(Year >= 1987 & Year <= 1994)
valid <- PowderyMildewEpidemic %>%
  filter(Year == 1995)

logit.model <- glm(Outbreak ~ MaxTemp + RelHumidity, data = train, family = "binomial")

logit_pred <- predict(logit.model, newdata = valid, type = "response")

threshold <- 0.5
outbreak_forecast <- ifelse(logit_pred >= threshold, 1, 0)
outbreak_forecast
```

Q6. Generate outbreak forecasts for years 1996, 1997 and 2000 by repeatedly moving the training period forward. For example, to forecast year 1996, partition the data so that years 1987-1995 are the training period. Then fit the logistic regression model and use it to generate a forecast (use threshold 0.5).

1996:

```{r}
train <- PowderyMildewEpidemic %>%
  filter(Year >= 1987 & Year <= 1995)
valid <- PowderyMildewEpidemic %>%
  filter(Year == 1996)

logit.model <- glm(Outbreak ~ MaxTemp + RelHumidity, data = train, family = "binomial")

logit_pred <- predict(logit.model, newdata = valid, type = "response")

threshold <- 0.5
outbreak_forecast <- ifelse(logit_pred >= threshold, 1, 0)
outbreak_forecast
```

1997:

```{r}
train <- PowderyMildewEpidemic %>%
  filter(Year >= 1987 & Year <= 1996)
valid <- PowderyMildewEpidemic %>%
  filter(Year == 1997)

logit.model <- glm(Outbreak ~ MaxTemp + RelHumidity, data = train, family = "binomial")

logit_pred <- predict(logit.model, newdata = valid, type = "response")

threshold <- 0.5
outbreak_forecast <- ifelse(logit_pred >= threshold, 1, 0)
outbreak_forecast
```

2000:

```{r}
train <- PowderyMildewEpidemic %>%
  filter(Year >= 1987 & Year <= 1999)
valid <- PowderyMildewEpidemic %>%
  filter(Year == 2000)

logit.model <- glm(Outbreak ~ MaxTemp + RelHumidity, data = train, family = "binomial")

logit_pred <- predict(logit.model, newdata = valid, type = "response")

threshold <- 0.5
outbreak_forecast <- ifelse(logit_pred >= threshold, 1, 0)
outbreak_forecast
```

Q7. Summarize the logistic regressionâ€™s predictive accuracy for these four years (1995-1997, 2000) in a classification matrix.

```{r}
# Actual values
actual <- c(0, 1, 0, 0)
# Predicted values
predicted <- c(0, 1, 1, 0)

# Creating the confusion matrix
confusionMatrix(as.factor(predicted), as.factor(actual))
```